{# templates/_partials/_cart_modal.html.twig #}

{# Centered cart modal #}
<div class="modal fade" id="cartModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow-sm">
            <div class="modal-header border-0">
                <h5 class="modal-title">Votre panier</h5>
            </div>
            <div class="modal-body">
                {% set cart = app.session.get('cart', []) %}

                {% if cart is empty %}
                    <p>Votre panier est vide.</p>
                {% else %}
                    <ul class="list-group">
                        {% for item in cart %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    {# Small placeholder image #}
                                    <img src="https://picsum.photos/50/50?random={{ item.id|default(loop.index) }}"
                                         alt="{{ item.title }}"
                                         class="me-2 rounded">

                                    <div>
                                        <strong>{{ item.title }}</strong><br>
                                        <small class="text-muted">{{ item.category|default('Sans catégorie') }}</small>
                                    </div>
                                </div>

                                <div>
                                    {{ item.quantity }} x {{ item.price }} €
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
            <div class="modal-footer border-0 d-flex justify-content-between">
                <a href="{{ path('app_cart_index') }}" class="btn btn-success">Passer la commande</a>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Continuer mes achats</button>
            </div>
        </div>
    </div>
</div>

{# Open modal automatically if session 'showCartModal' is true #}
{% if app.session.get('showCartModal', false) %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const cartModal = new bootstrap.Modal(document.getElementById('cartModal'));
            cartModal.show();
        });
    </script>

    {# Remove the session key so it doesn’t show again on refresh #}
    {% do app.session.remove('showCartModal') %}
{% endif %}
